#include <iostream>
#include <iomanip>
#include "hardwareapi.h"

unsigned char Check_sum(unsigned char* r_d, unsigned short Len) {
    unsigned short i;
    unsigned char Out_crc = 0;
    for (i = 0; i < Len; i++) {
        Out_crc += r_d[i];
    }

    // // print the whole Out_crc out in hex format
    // std::cout << "Out_crc: " << std::hex << std::setw(2) << std::setfill('0') << static_cast<int>(Out_crc) << std::endl;

    return Out_crc;
}

unsigned pass_word[256]=
{
0x44,0xaa,0x1f,0xbf,0x6a,0x43,0x37,0x47,0x0a,0xb9,0x92,0xe3,0x9e,0xcf,0xef,0x0c, // 15
0xe0,0xb3,0xad,0xfd,0x98,0x3e,0xd3,0x9d,0x02,0x7f,0x79,0xeb,0xf9,0xbc,0xe0,0xd1, // 31
0x4b,0x30,0x16,0x1d,0xbe,0xd1,0x3a,0xb6,0x26,0x64,0xdf,0xa7,0x61,0x01,0xdb,0xdb, // 47
0x1d,0x39,0x0d,0xc1,0x9b,0xb5,0xc6,0x04,0xd1,0x2c,0x18,0x5c,0xea,0xad,0x13,0x48, // 63
0x6b,0x83,0x72,0x93,0xd3,0x99,0x0d,0xeb,0x39,0xce,0x01,0x47,0xc1,0x6e,0x34,0xb9, // 79
0x75,0x4a,0xcc,0xfe,0xf7,0x6e,0x42,0x45,0x42,0x59,0x34,0x5d,0xba,0xb3,0x9b,0x76, // 95
0xf9,0x0c,0x35,0xfb,0xcd,0x98,0x11,0xf0,0xc0,0x3b,0xd1,0x53,0xf4,0x68,0x04,0x0e, // 111
0x9b,0x47,0x3b,0x80,0x46,0xb8,0x7c,0xe7,0xf4,0x43,0xbf,0xa8,0x1b,0x0b,0xfd,0x50, // 127
0x93,0x05,0x92,0x3e,0xd9,0x2e,0xec,0xf0,0x5a,0xdd,0x49,0x53,0x46,0x2d,0x5b,0x61, // 143
0x13,0x73,0xd0,0x34,0xda,0x95,0xd4,0x72,0xe2,0x39,0x13,0x63,0x95,0xff,0x5d,0x3b, // 159
0xff,0xae,0x1a,0x71,0x91,0xd3,0x28,0x62,0x01,0x9b,0x10,0xf8,0x59,0xfa,0xd1,0x7c, // 175
0xe2,0x8a,0x4b,0x81,0x53,0x19,0xc3,0x5b,0x6b,0x44,0x11,0xdd,0xb2,0xad,0xcf,0x69, // 191
0xf0,0xb2,0x32,0x97,0xec,0xeb,0x7b,0xc9,0xe8,0xa9,0x66,0x29,0x09,0xc2,0x4b,0x15, // 207
0x2e,0x91,0x34,0xfa,0x6e,0xdc,0x56,0xf1,0x83,0xa3,0x42,0xb6,0xc4,0x56,0x83,0x7d, // 223
0xb9,0x59,0x2a,0xbb,0x48,0xac,0x6a,0x62,0xa6,0x4c,0x33,0xfb,0xc9,0x19,0xe9,0x51, // 239
0x70,0x9f,0xdd,0x7f,0x69,0xce,0x58,0x48,0x39,0xaf,0x1a,0x7a,0xd3,0xac,0x23,0xed  // 255
};

// get the last two bit of out_crc, and find the corresponding value in pass_word
unsigned char find_crc(unsigned char out_crc) {
    unsigned char crc = 0;
    crc = pass_word[out_crc];
    // print the crc
    // std::cout << "CRC: " << std::hex << std::setw(2) << std::setfill('0') << static_cast<int>(crc) << std::endl;
    return crc;
}